#{extends 'main.html' /}
#{set title:'Home' /}
<script type="application/javascript">
    var highlight = "highlight";
    $( document ).ready(function() {
        $('.audioTrack').click(function(){
            console.log("click@")
            $('.highlight').removeClass('highlight');
            $(this).addClass('highlight');
            playAudio(this.id);
        });

        $("#ownVibe").bind("ended", function(){
            nextAudio();
        });
        function playAudio(id){
            document.ownVibe = document.getElementById("ownVibe");
            document.ownVibe.idAudio = id;
            document.ownVibe.src = "/audio/" + id;
            document.ownVibe.play();

            $(".audioTrack").removeClass(highlight);
            $(event.target).addClass('highlight');
        }
        function nextAudio(){
            document.ownVibe.idAudio = $(document.getElementById(document.ownVibe.idAudio)).next()[0].id;
            document.ownVibe.src = "/audio/" + document.ownVibe.idAudio;

            $(".audioTrack").removeClass(highlight);
            $("#" + document.ownVibe.idAudio).addClass('highlight');
            document.ownVibe.play();
        }
    });

</script>

<div id="middleman">
    <audio controls preload id="ownVibe">
        <source src="/audio/1">
    </audio>
    <ul>
    #{list items:audios, as:'audio'}
        <li class="audioTrack" id="${audio.id}">#{if audio.title != null }${audio.artist} â€“ ${audio.title}#{/if}#{else}${audio.name}#{/else}</li>
    #{/list}
    </ul>

    #{form @Application.upload(audio), enctype:'multipart/form-data', method:'POST'}
        <input type="file" name="audioFile">
        <input type="submit" value="Submit">
    #{/form}

    <a href="@{Application.logout()}">Logout</a>
</div>
